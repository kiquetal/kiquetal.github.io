---
import Layout from '../layouts/Layout.astro';

const translations = {
  en: {
    title: "Contact Me",
    subtitle: "Let's build something amazing together",
    nameLabel: "Name",
    emailLabel: "Email",
    messageLabel: "Message",
    submitBtn: "Send Message",
    sending: "Sending...",
    success: "Message sent successfully!",
    error: "Failed to send message. Please try again."
  },
  es: {
    title: "Contáctame",
    subtitle: "Construyamos algo increíble juntos",
    nameLabel: "Nombre",
    emailLabel: "Correo",
    messageLabel: "Mensaje",
    submitBtn: "Enviar Mensaje",
    sending: "Enviando...",
    success: "¡Mensaje enviado con éxito!",
    error: "Error al enviar el mensaje. Inténtalo de nuevo."
  }
};
---

<Layout title="Contact - System Engineer">
	<main>
		<div class="lang-switch">
			<button id="lang-en" class="active">EN</button>
			<span class="separator">/</span>
			<button id="lang-es">ES</button>
		</div>

		<div class="contact-container">
			<h1 id="title-text">{translations.en.title}</h1>
			<p class="subtitle" id="subtitle-text">{translations.en.subtitle}</p>

			<form id="contact-form" class="contact-form">
				<div class="form-group">
					<label for="name" id="name-label">{translations.en.nameLabel}</label>
					<input type="text" id="name" name="name" required />
				</div>

				<div class="form-group">
					<label for="email" id="email-label">{translations.en.emailLabel}</label>
					<input type="email" id="email" name="email" required />
				</div>

				<div class="form-group">
					<label for="message" id="message-label">{translations.en.messageLabel}</label>
					<textarea id="message" name="message" rows="5" required></textarea>
				</div>

				<button type="submit" id="submit-btn" class="submit-btn">
					{translations.en.submitBtn}
				</button>

				<div id="form-status" class="form-status hidden"></div>
			</form>
		</div>
	</main>
</Layout>

<script define:vars={{ translations }}>
	// Language Switcher Logic
	const btnEn = document.getElementById('lang-en');
	const btnEs = document.getElementById('lang-es');
	let currentLang = localStorage.getItem('preferred-lang') || 'en';

	function setLanguage(lang) {
		currentLang = lang;
		const t = translations[lang];
		
		document.getElementById('title-text').textContent = t.title;
		document.getElementById('subtitle-text').textContent = t.subtitle;
		document.getElementById('name-label').textContent = t.nameLabel;
		document.getElementById('email-label').textContent = t.emailLabel;
		document.getElementById('message-label').textContent = t.messageLabel;
		document.getElementById('submit-btn').textContent = t.submitBtn;

		if (lang === 'en') {
			btnEn.classList.add('active');
			btnEs.classList.remove('active');
		} else {
			btnEs.classList.add('active');
			btnEn.classList.remove('active');
		}
		localStorage.setItem('preferred-lang', lang);
	}

	btnEn.addEventListener('click', () => setLanguage('en'));
	btnEs.addEventListener('click', () => setLanguage('es'));
	setLanguage(currentLang);

	// Form Submission Logic
	const form = document.getElementById('contact-form');
	const statusDiv = document.getElementById('form-status');
	const submitBtn = document.getElementById('submit-btn');

	form.addEventListener('submit', async (e) => {
		e.preventDefault();
		const t = translations[currentLang];
		
		submitBtn.disabled = true;
		submitBtn.textContent = t.sending;
		statusDiv.classList.add('hidden');
		statusDiv.className = 'form-status hidden';

		const formData = new FormData(form);
		const data = Object.fromEntries(formData);

		try {
			const response = await fetch('https://emails.kiquetal.workers.dev', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(data),
			});

			if (response.ok) {
				statusDiv.textContent = t.success;
				statusDiv.classList.add('success');
				form.reset();
			} else {
				throw new Error('Network response was not ok');
			}
		} catch (error) {
			statusDiv.textContent = t.error;
			statusDiv.classList.add('error');
		} finally {
			submitBtn.disabled = false;
			submitBtn.textContent = t.submitBtn;
			statusDiv.classList.remove('hidden');
		}
	});
</script>

<style>
	main {
		margin: auto;
		padding: 4rem 2rem;
		width: 100%;
		max-width: 600px;
		color: #e2e8f0;
		position: relative;
	}

	.lang-switch {
		position: absolute;
		top: 2rem;
		right: 2rem;
		display: flex;
		align-items: center;
		gap: 0.5rem;
		font-weight: 600;
	}

	.lang-switch button {
		background: none;
		border: none;
		color: #64748b;
		cursor: pointer;
		font-size: 1rem;
		padding: 0.25rem;
		transition: color 0.2s;
	}

	.lang-switch button:hover {
		color: #94a3b8;
	}

	.lang-switch button.active {
		color: rgb(var(--accent));
	}

	.separator {
		color: #475569;
	}

	h1 {
		font-size: 3rem;
		font-weight: 800;
		text-align: center;
		margin-bottom: 0.5rem;
		background-image: var(--accent-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
	}

	.subtitle {
		text-align: center;
		color: #94a3b8;
		margin-bottom: 3rem;
		font-size: 1.2rem;
	}

	.contact-form {
		background: rgba(255, 255, 255, 0.03);
		padding: 2rem;
		border-radius: 16px;
		border: 1px solid rgba(255, 255, 255, 0.1);
	}

	.form-group {
		margin-bottom: 1.5rem;
	}

	label {
		display: block;
		margin-bottom: 0.5rem;
		color: #f8fafc;
		font-weight: 600;
	}

	input, textarea {
		width: 100%;
		padding: 0.8rem;
		border-radius: 8px;
		background: rgba(15, 23, 42, 0.6);
		border: 1px solid rgba(255, 255, 255, 0.1);
		color: white;
		font-family: inherit;
		transition: border-color 0.2s;
		box-sizing: border-box;
	}

	input:focus, textarea:focus {
		outline: none;
		border-color: rgb(var(--accent));
	}

	.submit-btn {
		width: 100%;
		padding: 1rem;
		background: rgb(var(--accent));
		color: white;
		border: none;
		border-radius: 8px;
		font-weight: 800;
		cursor: pointer;
		transition: all 0.2s;
		font-size: 1rem;
	}

	.submit-btn:hover {
		background: rgb(var(--accent-dark));
		transform: translateY(-2px);
	}

	.submit-btn:disabled {
		opacity: 0.7;
		cursor: not-allowed;
		transform: none;
	}

	.form-status {
		margin-top: 1rem;
		padding: 1rem;
		border-radius: 8px;
		text-align: center;
		font-weight: 600;
	}

	.form-status.success {
		background: rgba(34, 197, 94, 0.2);
		color: #4ade80;
		border: 1px solid rgba(34, 197, 94, 0.3);
	}

	.form-status.error {
		background: rgba(239, 68, 68, 0.2);
		color: #f87171;
		border: 1px solid rgba(239, 68, 68, 0.3);
	}
</style>
