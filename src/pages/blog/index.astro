---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
---

<Layout title="Blog - System Engineer">
	<main>
		<div class="header-row">
			<h1>Blog</h1>
			<div class="lang-switch">
				<button id="lang-en" class="active">EN</button>
				<span class="separator">/</span>
				<button id="lang-es">ES</button>
			</div>
		</div>

		<div class="posts-grid">
			{posts.map(post => (
				<article class="post-card">
					<span class="post-date">{post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
					<h2 class="lang-en">{post.data.title.en}</h2>
					<h2 class="lang-es hidden">{post.data.title.es}</h2>
					
					<p class="lang-en">{post.data.excerpt.en}</p>
					<p class="lang-es hidden">{post.data.excerpt.es}</p>
					
					<a href={`/blog/${post.slug}`} class="read-more">
						<span class="lang-en">Read more →</span>
						<span class="lang-es hidden">Leer más →</span>
					</a>
				</article>
			))}
		</div>
	</main>
</Layout>

<script>
	const btnEn = document.getElementById('lang-en');
	const btnEs = document.getElementById('lang-es');
	const enElements = document.querySelectorAll('.lang-en');
	const esElements = document.querySelectorAll('.lang-es');

	function setLanguage(lang) {
		if (lang === 'en') {
			btnEn.classList.add('active');
			btnEs.classList.remove('active');
			enElements.forEach(el => el.classList.remove('hidden'));
			esElements.forEach(el => el.classList.add('hidden'));
		} else {
			btnEs.classList.add('active');
			btnEn.classList.remove('active');
			esElements.forEach(el => el.classList.remove('hidden'));
			enElements.forEach(el => el.classList.add('hidden'));
		}
		localStorage.setItem('preferred-lang', lang);
	}

	btnEn.addEventListener('click', () => setLanguage('en'));
	btnEs.addEventListener('click', () => setLanguage('es'));

	// Check for saved preference
	const savedLang = localStorage.getItem('preferred-lang');
	if (savedLang) {
		setLanguage(savedLang);
	}
</script>

<style>
	main {
		margin: auto;
		padding: 4rem 2rem;
		width: 100%;
		max-width: 800px;
		color: #e2e8f0;
	}

	.header-row {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 4rem;
	}

	h1 {
		font-size: 3rem;
		font-weight: 800;
		margin: 0;
		background-image: var(--accent-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
	}

	.lang-switch {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		font-weight: 600;
	}

	.lang-switch button {
		background: none;
		border: none;
		color: #64748b;
		cursor: pointer;
		font-size: 1rem;
		padding: 0.25rem;
		transition: color 0.2s;
	}

	.lang-switch button:hover {
		color: #94a3b8;
	}

	.lang-switch button.active {
		color: rgb(var(--accent));
	}

	.separator {
		color: #475569;
	}

	.posts-grid {
		display: grid;
		gap: 2rem;
	}

	.post-card {
		background: rgba(255, 255, 255, 0.03);
		border: 1px solid rgba(255, 255, 255, 0.1);
		padding: 2rem;
		border-radius: 16px;
		transition: transform 0.2s ease;
	}

	.post-card:hover {
		transform: translateY(-2px);
		background: rgba(255, 255, 255, 0.05);
	}

	.post-date {
		font-size: 0.875rem;
		color: #64748b;
	}

	h2 {
		margin: 0.5rem 0 1rem;
		font-size: 1.5rem;
		color: #f8fafc;
	}

	p {
		color: #94a3b8;
		line-height: 1.6;
		margin-bottom: 1.5rem;
	}

	.read-more {
		color: rgb(var(--accent));
		text-decoration: none;
		font-weight: 600;
		display: inline-block;
	}

	.read-more:hover {
		text-decoration: underline;
	}

	.hidden {
		display: none;
	}
</style>
